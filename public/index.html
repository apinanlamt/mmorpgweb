<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MMORPG Web</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; }
    #loginDiv, #gameDiv { max-width: 600px; margin: auto; }
    #gameDiv { display: none; }
    #gameMap { width: 600px; height: 400px; border: 1px solid #000; overflow: scroll; position: relative; background: #eee; margin: 10px auto; }
    .player, .monster { position: absolute; width: 30px; height: 30px; text-align: center; line-height: 30px; border-radius: 5px; }
    .player { background-color: blue; color: white; }
    .monster { background-color: red; color: white; }
    #chatBox { border: 1px solid #ccc; height: 150px; overflow-y: scroll; margin-top: 10px; padding: 5px; text-align: left; }
    #hpBar, #expBar { height: 20px; background: green; margin-bottom: 5px; }
    #hpContainer, #expContainer { width: 100%; background: #ddd; margin: 5px 0; }
    #questsList { text-align: left; margin: 10px auto; max-width: 600px; }
    button { margin: 5px; }
  </style>
</head>
<body>
  <div id="loginDiv">
    <h2>Login/Register</h2>
    <input id="username" placeholder="Username" /><br>
    <input id="password" placeholder="Password" type="password" /><br>
    <button id="btnLogin">Login</button>
    <button id="btnRegister">Register</button>
    <div id="loginMsg"></div>
  </div>

  <div id="gameDiv">
    <h3>Welcome, <span id="playerName"></span></h3>

    <div id="hpContainer">
      <div id="hpBar"></div>
    </div>
    <div id="expContainer">
      <div id="expBar"></div>
    </div>

    <div>Level: <span id="level"></span></div>

    <h4>Quests</h4>
    <ul id="questsList"></ul>

    <div id="gameMap"></div>

    <input id="chatInput" placeholder="Type message and press Enter..." />
    <div id="chatBox"></div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    const loginDiv = document.getElementById('loginDiv');
    const gameDiv = document.getElementById('gameDiv');
    const loginMsg = document.getElementById('loginMsg');
    const btnLogin = document.getElementById('btnLogin');
    const btnRegister = document.getElementById('btnRegister');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const playerName = document.getElementById('playerName');
    const levelSpan = document.getElementById('level');

    btnLogin.addEventListener('click', () => handleAuth('/login'));
    btnRegister.addEventListener('click', () => handleAuth('/register'));

    async function handleAuth(endpoint) {
      const username = usernameInput.value.trim();
      const password = passwordInput.value.trim();

      if (!username || !password) {
        loginMsg.textContent = 'Please enter username and password';
        return;
      }

      try {
        const res = await fetch(endpoint, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });
        const data = await res.json();
        if (data.success) {
          loginDiv.style.display = 'none';
          gameDiv.style.display = 'block';
          playerName.textContent = username;
        } else {
          loginMsg.textContent = data.message || 'Authentication failed';
        }
      } catch (e) {
        loginMsg.textContent = 'Server error';
      }
    }

    // Allow Enter to trigger login
    passwordInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        handleAuth('/login');
      }
    });
    usernameInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        handleAuth('/login');
      }
    });
  </script>
  <script src="client.js"></script>
</body>
</html>
